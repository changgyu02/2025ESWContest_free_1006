import rclpy
from rclpy.node import Node
from std_srvs.srv import SetBool

class DirtCheckClient(Node):
    def __init__(self):
        super().__init__('dirt_check_client')
        self.client = self.create_client(SetBool, 'dirt_check_service')

        while not self.client.wait_for_service(timeout_sec=1.0):
            self.get_logger().info('ğŸ”„ dirt_check_serviceë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...')

        self.get_logger().info('âœ… dirt_check_service ì—°ê²° ì™„ë£Œ.')

        input("ğŸ”˜ ì—”í„° í‚¤ë¥¼ ëˆ„ë¥´ë©´ ì˜¤ì—¼ë„ íŒë‹¨ì„ ìš”ì²­í•©ë‹ˆë‹¤...")

        request = SetBool.Request()
        request.data = True

        self.future = self.client.call_async(request)
        self.future.add_done_callback(self.response_callback)

    def response_callback(self, future):
        try:
            response = future.result()
            result = "ğŸŸ  ë”ëŸ½ìŠµë‹ˆë‹¤." if response.success else "âœ… ê¹¨ë—í•©ë‹ˆë‹¤."
            self.get_logger().info(f'ğŸ§ª íŒë‹¨ ê²°ê³¼: {result}')
        except Exception as e:
            self.get_logger().error(f'âŒ ì„œë¹„ìŠ¤ ìš”ì²­ ì‹¤íŒ¨: {e}')


def main(args=None):
    rclpy.init(args=args)
    node = DirtCheckClient()
    rclpy.spin_once(node, timeout_sec=5)  # ì‘ë‹µ ëŒ€ê¸°
    node.destroy_node()
    rclpy.shutdown()
